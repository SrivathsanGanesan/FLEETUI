<div class="popup-overlay">
  <div class="popup-content"  [ngClass]="{ 'fixed-size': showImage, 'dynamic-size': !showImage }" [ngStyle]="{ 'pointer-events': showImage ? 'none' : 'auto' }">

    <h2 *ngIf="!showImage">Select and insert Map file</h2>
    <!-- Image for file upload -->
    <label for="fileInput" class="upload-image" *ngIf="!showImage">
      <img src="../../assets/icons/arrow-down-circle.svg" alt="Upload" />
      <input
        type="file"
        id="fileInput"
        accept="image/png, image/jpeg"
        (change)="onFileSelected($event)"
        hidden
      />
    </label>
    <!-- Display selected file name -->
    <div *ngIf="fileName && !showImage" class="file-name">{{ fileName }}</div>
    <div class="form-wrapper" *ngIf="fileName && !showImage">
      <!-- Form for additional details -->
      <div class="form-container" *ngIf="fileName && !showImage">
        <label for="mapName">Map Name</label>
        <input
          type="text"
          id="mapName"
          [(ngModel)]="mapName"
          placeholder="Enter map name"
          (keyup.enter)="open()"
        />

        <label for="siteName">Site Name</label>
        <input
          type="text"
          id="siteName"
          [(ngModel)]="siteName"
          placeholder="Enter site name"
          (keyup.enter)="open()"
        />
      </div>
      <div class="separator"></div>
      <div class="form1-container" *ngIf="fileName && !showImage">
        <div class="Res">
          <label for="resolution">Resolution</label>
          <div class="Res1">
            <input
              type="number"
              id="resolution"
              #resolutionInput
              placeholder="Enter Resolution"
              (keyup.enter)="open()"
            />
            <p id="or">or</p>
            <button class="OpenandLocate" (click)="openImagePopup()">
              Open and Locate
            </button>
          </div>
        </div>
        <p>Origin</p>
        <div
          class="origin-coor"
          style="display: flex; align-items: center; gap: 10px"
        >
          <input type="number" id="X" placeholder="X" (keyup.enter)="open()" />
          <input type="number" id="Y" placeholder="Y" (keyup.enter)="open()" />
          <!-- <input
        type="number"
        id="θ"
        placeholder="θ"
        (keyup.enter)="open()"
      /> -->
        </div>
      </div>
    </div>
    <!-- <label for="height">Enter Height (m)</label>
      <input
        type="number"
        id="height"
        [(ngModel)]="height"
        placeholder="Enter height"
        (keyup.enter)="open()"
      />
      
      <label for="width">Enter Width (m)</label>
      <input
        type="number"
        id="width"
        [(ngModel)]="width"
        placeholder="Enter width"
        (keyup.enter)="open()"
      /> -->
    <!-- Intermediate Nodes Dialog -->
    <div *ngIf="showImagePopup" class="image-popup-overlay">
      <div class="image-popup-content">
        <canvas class="imagePopupCanvas" #imagePopupCanvas></canvas>
        <button class="close-btn" (click)="closeImagePopup()">X</button>
        <button
          *ngIf="isDistanceConfirmed"
          class="save-btn"
          (click)="saveCanvas()"
        >
          Save
        </button>
        <button class="clear-btn" (click)="clearCanvas()">Clear</button>

        <!-- Distance Input Dialog -->
        <div *ngIf="showDistanceDialog" class="distance-dialog-overlay">
          <div class="distance-dialog">
            <h3>Enter Distance Between Points</h3>
            <input
              type="number"
              [(ngModel)]="distanceBetweenPoints"
              placeholder="Distance in meters"
            />
            <!-- Display error message conditionally -->
            <div *ngIf="showError" class="distance-error-message">
              Please enter distance between two points in meters.
            </div>
            <button (click)="confirmDistance()">Enter</button>
          </div>
        </div>
      </div>
    </div>
    <div class="image-container" *ngIf="showImage"  [ngStyle]="{ 'pointer-events': showImage ? 'auto' : 'none' }">
      <button class="close-btn" (click)="close()" *ngIf="!isPlottingEnabled && !isZonePlottingEnabled">X</button>


      <canvas class="plottinglayer" #overlayCanvas *ngIf="showImage" ></canvas> 
      <div
        #nodeDetailsPopup
        class="node-details-popup"
        [style.display]="isNodeDetailsPopupVisible ? 'block' : 'none'"
      >
        <div class="sampleCSS">
          <div class="node_details">
            <p>Node Details</p>
            <div class="node-id">Node ID: {{ nodeDetails.id }}</div>
            <div class="action-container">
              <label for="nodeAction">Add Action:</label>
              <select
                id="nodeAction"
                [(ngModel)]="selectedAction"
                (change)="onActionChange()"
              >
                <option value="Move" [disabled]="isOptionDisabled('Move')">
                  Move
                </option>
                <option value="Dock" [disabled]="isOptionDisabled('Dock')">
                  Dock
                </option>
                <option value="Undock" [disabled]="isOptionDisabled('Undock')">
                  Undock
                </option>
              </select>
            </div>

            <div *ngIf="actions.length > 0" class="action-div">
              <p>Actions:</p>
              <div class="action-buttons">
                <div
                  *ngFor="let action of actions; let i = index"
                  class="action-item"
                >
                  <button class="action-button" (click)="editAction(i)">
                    {{ action.actionType }}
                    <span class="delete-icon" (click)="removeAction(i)">X</span>
                  </button>
                </div>
              </div>
            </div>

            <label for="nodeDescription">Node Description:</label>
            <input
              type="text"
              id="nodeDescription"
              [(ngModel)]="nodeDetails.description"
            /><br />
            <label for="Intermediate_Stn">Intermediate Node</label>
            <input type="checkbox" id="Intermediate_Stn" [(ngModel)]="nodeDetails.intermediate_node"><br>
            
            <label for="Waiting_Stn">Waiting Node</label>
            <input type="checkbox" id="Waiting_Stn" [(ngModel)]="nodeDetails.waiting_node">           
            
          </div>

          <div class="action-form">
            <div
              *ngIf="selectedAction === 'Move' && isMoveActionFormVisible"
              class="move-action-form"
            >
              <p>Move Action Parameters</p>
              <label>Max Linear Velocity:</label>
              <input
                type="number"
                [(ngModel)]="moveParameters.maxLinearVelocity"
              /><br />
              <label>Max Angular Velocity:</label>
              <input
                type="number"
                [(ngModel)]="moveParameters.maxAngularVelocity"
              /><br />
              <label>Max Tolerance at Goal X:</label>
              <input
                type="number"
                [(ngModel)]="moveParameters.maxToleranceAtGoalX"
              /><br />
              <label>Max Tolerance at Goal Y:</label>
              <input
                type="number"
                [(ngModel)]="moveParameters.maxToleranceAtGoalY"
              /><br />
              <label>Max Tolerance at Goal Orientation:</label>
              <input
                type="number"
                [(ngModel)]="moveParameters.maxToleranceAtGoalOrientation"
              /><br />
              <label>End Point Orientation:</label>
              <input
                type="checkbox"
                [(ngModel)]="moveParameters.endPointOrientation"
              /><br />
              <label>Auto Robot Operation Mode:</label>
              <select [(ngModel)]="moveParameters.autoRobotMode">
                <option value="mode1">Mode 1</option>
                <option value="mode2">Mode 2</option>
                <!-- Add more options as needed --></select
              ><br />
              <button (click)="addAction()">Add</button>
            </div>

            <div
              *ngIf="selectedAction === 'Dock' && isDockActionFormVisible"
              class="move-action-form"
            >
              <p>Dock Action Parameters</p>
              <label>Max Linear Velocity:</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.maxAngularVelocity"
              /><br />
              <label>Max Tolerance at Goal X:</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.maxToleranceAtGoalX"
              /><br />
              <label>Max Tolerance at Goal Y:</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.maxToleranceAtGoalY"
              /><br />
              <label>Max Tolerance at Goal Orientation:</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.maxToleranceAtGoalOrientation"
              /><br />
              <label>Goal offset X</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.goalOffsetX"
              /><br />
              <label>Goal offset Y</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.goalOffsetY"
              /><br />
              <label>Goal offset Orientation</label>
              <input
                type="number"
                [(ngModel)]="dockParameters.goalOffsetOrientation"
              /><br />
              <label>End Point Orientation:</label>
              <input
                type="checkbox"
                [(ngModel)]="dockParameters.endPointOrientation"
              /><br />
              <label>Docking Type: </label>
              <select [(ngModel)]="dockParameters.dockingType">
                <option value="mode1">Mode 1</option>
                <option value="mode2">Mode 2</option>
                <!-- Add more options as needed --></select
              ><br />
              <button (click)="addAction()">Add</button>
            </div>

            <div
              *ngIf="selectedAction === 'Undock' && isUndockActionFormVisible"
              class="move-action-form"
            >
              <p>Undock Action Parameters</p>
              <label>Max Linear Velocity:</label>
              <input
                type="number"
                [(ngModel)]="undockParameters.maxLinearVelocity"
              /><br />
              <label>Max Angular Velocity:</label>
              <input
                type="number"
                [(ngModel)]="undockParameters.maxAngularVelocity"
              /><br />
              <label>Max Tolerance at Goal X:</label>
              <input
                type="number"
                [(ngModel)]="undockParameters.maxToleranceAtGoalX"
              /><br />
              <label>Max Tolerance at Goal Y:</label>
              <input
                type="number"
                [(ngModel)]="undockParameters.maxToleranceAtGoalY"
              /><br />
              <label>Max Tolerance at Goal Orientation:</label>
              <input
                type="number"
                [(ngModel)]="undockParameters.maxToleranceAtGoalOrientation"
              /><br />
              <label>End Point Orientation:</label>
              <input
                type="checkbox"
                [(ngModel)]="undockParameters.endPointOrientation"
              /><br />
              <label>Undocking Distance</label>
              <input
                type="number"
                [(ngModel)]="undockParameters.undockingDistance"
              /><br />

              <br />
              <button (click)="addAction()">Add</button>
            </div>
          </div>
        </div>
        <div class="Node-btn">
          <button class="Delnode-btn" (click)="deleteSelectedNode()">Delete Node</button>
          <button class="savenode-btn" (click)="saveNodeDetails()">Save</button>
          <button class="closenode-btn" (click)="closeNodeDetailsPopup()">
            Close
          </button>
        </div>
      </div>
      <!-- Transparent canvas for plotting points -->
      <canvas class="maplayer" #imageCanvas></canvas>

      <div class="options-container" *ngIf="!isPlottingEnabled && !isOptionsMenuVisible" >
        <button (click)="toggleOptionsMenu()">
          <img src="../../assets/icons/options-icon.svg" alt="Options" />
        </button>
      </div>
      <div class="calibration-layer" *ngIf="isOptionsMenuVisible" >
        <div class="dropdown">
          <button class="dropdown-button">Add Node</button>
          <div class="dropdown-content">
            <button (click)="setPlottingMode('single')">Single Node</button>
            <button (click)="setPlottingMode('multi')">Multi Node</button>
          </div>
        </div>
        <button (click)="deleteSelectedNode()">Delete Node</button>
        <div class="dropdown">
          <button class="dropdown-button">Connectivity</button>
          <div class="dropdown-content">
            <button (click)="setDirection('uni')">Uni-Directional</button>
            <button (click)="setDirection('bi')">Bi-Directional</button>
          </div>
        </div>
        <button (click)="startZonePlotting()">Zones</button>

        <div class="dropdown">
          <button class="dropdown-button">Add Assets</button>
          <div class="dropdown-content">
            <button (click)="selectAssetType('docking')">Docking Station</button>
            <button (click)="selectAssetType('charging')">Charging Station</button>
          </div>
        </div>
        
        <button (click)="openRobotPopup()">Add Robots</button>
        <button (click)="removeRobots()">Remove Robots</button>
        <button (click)="saveOpt()">Save</button>
        <button (click)="toggleOptionsMenu()">Back</button>

      </div>
    </div>
    <div class="button-container" *ngIf="!showImage">
      <button *ngIf="fileName && !showImage" (click)="open()">Open</button>
      <button (click)="close()">Close</button>
    </div>
  </div>
</div>

<app-robot-popup
[isVisible]="isRobotPopupVisible"
(close)="closeRobotPopup()"
(addRobot)="placeRobots($event)"
></app-robot-popup>

<div *ngIf="isPopupVisible" class="popup-overlay1">
  <div class="popup-content1">
    <h4>Select Zone Type</h4>
    <select [(ngModel)]="zoneType">
      <option *ngFor="let zone of zoneTypeList" [value]="zone">{{ zone }}</option>
    </select>
    <div>
    <button (click)="zoneType !== null ? onZoneTypeSelected(zoneType) : null">Confirm</button>
    <button (click)="onDeleteZone()">Delete</button>
    <button (click)="onCancel()">Cancel</button>
  </div>
  </div>
</div>

<div *ngIf="showPopup" class="popup-overlay1">
  <div class="popup-content1">
    <h3>Edge Details</h3>
    <!-- <form (ngSubmit)="submitEdgeDetails()"> -->
      <div class="form-row">
        <label for="edgeId">Edge ID:</label>
        <input id="edgeId" [(ngModel)]="currentEdge.edgeId" name="edgeId" required />
      </div>

      <div class="form-row">
        <label for="sequenceId">Sequence ID:</label>
        <input id="sequenceId" type="number" [(ngModel)]="currentEdge.sequenceId" name="sequenceId" required />
      </div>

      <div class="form-row">
        <label for="edgeDescription">Description:</label>
        <input id="edgeDescription" [(ngModel)]="currentEdge.edgeDescription" name="edgeDescription" />
      </div>

      <div class="form-row">
        <label for="released">Released:</label>
        <input id="released" type="checkbox" [(ngModel)]="currentEdge.released" name="released" />
      </div>

      <div class="form-row">
        <label for="startNodeId">Start Node ID:</label>
        <input id="startNodeId" [(ngModel)]="currentEdge.startNodeId" name="startNodeId" readonly />
      </div>

      <div class="form-row">
        <label for="endNodeId">End Node ID:</label>
        <input id="endNodeId" [(ngModel)]="currentEdge.endNodeId" name="endNodeId" readonly />
      </div>

      <div class="form-row">
        <label for="maxSpeed">Max Speed (m/s):</label>
        <input id="maxSpeed" type="number" [(ngModel)]="currentEdge.maxSpeed" name="maxSpeed" />
      </div>

      <div class="form-row">
        <label for="maxHeight">Max Height (m):</label>
        <input id="maxHeight" type="number" [(ngModel)]="currentEdge.maxHeight" name="maxHeight" />
      </div>

      <div class="form-row">
        <label for="minHeight">Min Height (m):</label>
        <input id="minHeight" type="number" [(ngModel)]="currentEdge.minHeight" name="minHeight" />
      </div>

      <div class="form-row">
        <label for="orientation">Orientation (rad):</label>
        <input id="orientation" type="number" [(ngModel)]="currentEdge.orientation" name="orientation" />
      </div>

      <div class="form-row">
        <label for="orientationType">Orientation Type:</label>
        <input id="orientationType" [(ngModel)]="currentEdge.orientationType" name="orientationType" />
      </div>

      <div class="form-row">
        <label for="direction">Direction:</label>
        <select id="direction" [(ngModel)]="currentEdge.direction" name="direction">
          <option value="UN_DIRECTIONAL">Uni-directional</option>
          <option value="BI_DIRECTIONAL">Bi-directional</option>
        </select>
      </div>

      <div class="form-row">
        <label for="rotationAllowed">Rotation Allowed:</label>
        <input id="rotationAllowed" type="checkbox" [(ngModel)]="currentEdge.rotationAllowed" name="rotationAllowed" />
      </div>

      <div class="form-row">
        <label for="maxRotationSpeed">Max Rotation Speed (rad/s):</label>
        <input id="maxRotationSpeed" type="number" [(ngModel)]="currentEdge.maxRotationSpeed" name="maxRotationSpeed" />
      </div>

      <div class="form-row">
        <label for="length">Length:</label>
        <input id="length" type="number" [(ngModel)]="currentEdge.length" name="length" />
      </div>

      <div class="form-row">
        <label for="action">Actions:</label>
        <input id="action" [(ngModel)]="currentEdge.action" name="action" />
      </div>

      <div class="form-buttons">
        <button type="submit" id="formBTN" (click)="updateEdge()">Save</button>
        <button type="button" id="formBTN" (click)="deleteEdge()">Delete</button>
        <button type="button" id="formBTN" (click)="hidePopup()">Cancel</button>
      </div>
    <!-- </form> -->
  </div>
</div>

<div *ngIf="DockPopup" class="popup-overlay1">
  <div class="popup-content1">
    <form>
      <!-- Validation Message -->
      <h4>Docking Station Details</h4>

      <div class="UDform">
        <label for="undockingDistance">Undocking Distance:</label>
        <input 
          type="number" 
          id="undockingDistance" 
          name="undockingDistance" 
          [(ngModel)]="undockingDistance" 
          min="1" 
          max="1000" 
          required 
        />
      </div>
      
      <div class="UDform">
        <label for="description">Description:</label>
        <input 
          type="text" 
          id="description" 
          name="description" 
          [(ngModel)]="description" 
          required
        />
      </div>
      <div *ngIf="validationMessage" class="validation-message" style="color: red;font:10px sans-serif;">
        {{ validationMessage }}
      </div>
      <div>
        <button type="button" (click)="deleteSelectedAsset()">Delete</button>
        <button type="button" (click)="savePopupData()">Save</button>
        <button type="button" (click)="closePopup1()">Cancel</button>
      </div>
    </form>
  </div>
</div>


<div
class="popup-overlay1"
*ngIf="showIntermediateNodesDialog"
>
<div class="popup-content1">
  <h3>Enter Number of Nodes</h3>
  <input
    type="number"
    [(ngModel)]="numberOfIntermediateNodes"
    placeholder="Number of nodes"
    (ngModelChange)="onInputChanged()"
  />
  <button
    *ngIf="isEnterButtonVisible"
    (click)="plotIntermediateNodes()"
  >
    Enter
  </button>
</div>
</div> 

<div *ngIf="isConfirmationVisible" class="popup-overlay1">
  <div class="popup-content1">
  <p>Are you sure you want to delete this node?</p>
  <div>
  <button type="button" (click)="confirmDelete()">Confirm</button>
  <button type="button" (click)="cancelDelete()">Cancel</button>
</div>
</div>
</div>
