<div class="popup-overlay">
  <div
    class="popup-content"
    [ngClass]="{ 'fixed-size': showImage, 'dynamic-size': !showImage }"
    [ngStyle]="{ 'pointer-events': showImage ? 'none' : 'auto' }"
  >
    <h2 *ngIf="!showImage">Select and insert Map file</h2>
    <!-- Image for file upload -->
    <label for="fileInput" class="upload-image" *ngIf="!showImage">
      <img src="../../assets/icons/arrow-down-circle.svg" alt="Upload" />
      <input
        type="file"
        id="fileInput"
        accept="image/png, image/jpeg"
        (change)="onFileSelected($event)"
        hidden
      />
    </label>
    <!-- Display selected file name -->
    <div *ngIf="fileName && !showImage" class="file-name">{{ fileName }}</div>
    <div class="form-wrapper" *ngIf="fileName && !showImage">
      <!-- Form for additional details -->
      <div class="form-container" *ngIf="fileName && !showImage">
        <label for="mapName">Map Name</label>
        <input pInputText
          type="text"
          id="mapName"
          [(ngModel)]="mapName"
          placeholder="Enter map name"
        />

        <label for="siteName">Site Name</label>
        <input pInputText
          type="text"
          id="siteName"
          [(ngModel)]="siteName"
          placeholder="Enter site name"
          (keyup.enter)="open()"
        />
      </div>
      <div class="separator"></div>
      <div class="form1-container" *ngIf="fileName && !showImage">
        <div class="Res">
          <label for="resolution">Resolution</label>
          <!-- [(ngModel)]="resolution" -->
          <div class="Res1">
            <input pInputText
              type="number"
              id="resolution"
              #resolutionInput
              placeholder="Resolution"
              (keyup.enter)="open()"
              (input)="onInputResolution($event)"
            />
            <p id="or">or</p>
            <button class="OpenandLocate" (click)="openImagePopup()">
              Locate
            </button>
          </div>
        </div>
        <p>Origin</p>
        <div
          class="origin-coor"
          style="display: flex; align-items: center; gap: 10px"
        >
        <input pInputText type="number" id="X" placeholder="X" min="0" #originX [(ngModel)]="origin.x" (keyup.enter)="open()" />
        <input pInputText type="number" id="Y" placeholder="Y" min="0" #originY [(ngModel)]="origin.x" (keyup.enter)="open()" />
          <!-- <input
        type="number"
        id="θ"
        placeholder="θ"
        (keyup.enter)="open()"
      /> -->
        </div>
      </div>
    </div>
    <!-- <label for="height">Enter Height (m)</label>
      <input
        type="number"
        id="height"
        [(ngModel)]="height"
        placeholder="Enter height"
        (keyup.enter)="open()"
      />

      <label for="width">Enter Width (m)</label>
      <input
        type="number"
        id="width"
        [(ngModel)]="width"
        placeholder="Enter width"
        (keyup.enter)="open()"
      /> -->
    <!-- Intermediate Nodes Dialog -->
    <div *ngIf="showImagePopup" class="image-popup-overlay">
      <div class="image-popup-content">
        <canvas class="imagePopupCanvas" #imagePopupCanvas></canvas>
        <button class="close-btn" (click)="closeImagePopup()"> <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="24"
          height="24"
        >
          <path fill="none" d="M0 0h24v24H0z" />
          <path
            d="M12 10.586l4.95-4.95 1.414 1.414L13.414 12l4.95 4.95-1.414 1.414L12 13.414l-4.95 4.95-1.414-1.414L10.586 12 5.636 7.05l1.414-1.414L12 10.586z"
          />
        </svg></button>
        <button
          *ngIf="isDistanceConfirmed"
          class="save-btn"
          (click)="saveCanvas()"
        >
          Save
        </button>
        <button class="clear-btn" (click)="clearCanvas()">Clear</button>

        <!-- Distance Input Dialog -->
        <div *ngIf="showDistanceDialog" class="distance-dialog-overlay">
          <div class="distance-dialog">
            <h3>Enter Distance Between Points</h3>
            <input pInputText
              type="number"
                min="0"

              [(ngModel)]="distanceBetweenPoints"
              placeholder="Distance in meters"
            />
            <br>
            <!-- Display error message conditionally -->
            <div *ngIf="showError" class="distance-error-message">
              Please enter distance between two points in meters.
            </div>
            <button (click)="confirmDistance()">Enter</button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="image-container"
      *ngIf="showImage"
      [ngStyle]="{ 'pointer-events': showImage ? 'auto' : 'none' }"
    >
      <button
        class="close-btn"
        (click)="close()"
        *ngIf="!isPlottingEnabled && !isZonePlottingEnabled"
      >
          <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="24"
          height="24"
        >
          <path fill="none" d="M0 0h24v24H0z" />
          <path
            d="M12 10.586l4.95-4.95 1.414 1.414L13.414 12l4.95 4.95-1.414 1.414L12 13.414l-4.95 4.95-1.414-1.414L10.586 12 5.636 7.05l1.414-1.414L12 10.586z"
          />
        </svg>
      </button>

      <canvas class="plottinglayer" #overlayCanvas *ngIf="showImage"></canvas>
      <div
        *ngIf="isNodeDetailsPopupVisible"
        class="nodepopup-overlay"
      >
      <div
        #nodeDetailsPopup
        class="node-details-popup"
        [style.display]="isNodeDetailsPopupVisible ? 'block' : 'none'"
      >

      <div class="sampleCSS">
        <div class="node_details">
          <p>Node Details</p>

          <div class="action-container">
            <div class="action" class="display:flex; text-wrap:nowrap; align-items:center ">
              <label for="nodeAction" class="label" style="margin-right: 8rem;">Add Action:</label>
              <p-dropdown
                id="nodeAction"
                [options]="actionOptions"
                [(ngModel)]="selectedAction"
                (onChange)="onActionChange()"
                placeholder="Select Action"
                [autoDisplayFirst]="false"
                styleClass="small-dropdown"
                [style]="{'width':'143px !important'}"
              ></p-dropdown>
            </div>
            <!-- <div *ngIf="validationError" class="validation-error">{{ validationError }}</div> -->
          </div>

          <div *ngIf="actions.length > 0" class="action-div">
            <p>Actions:</p>
            <div class="action-buttons">
              <div *ngFor="let action of actions; let i = index" class="action-item">
                <button class="action-button" (click)="editAction(i)">
                  {{ action.actionType }}
                  <span class="delete-icon" (click)="removeAction(i)">X</span>
                </button>
              </div>
            </div>
          </div>

          <div class="input-group1">
            <label for="nodeDescription" class="label" style="margin-right: 2.8rem;">Node Description:</label>
            <input pInputText
              type="text"
              id="nodeDescription"
              [(ngModel)]="nodeDetails.description"
              [style]="{'height':'30px','width':'50%'}"
            /><br />
          </div>
            <div class="input-group">
              <div class="node1">
                <label for="Intermediate_Stn" class="label">Intermediate Node</label>
                <p-checkbox
                  id="Intermediate_Stn"
                  [binary]="true"
                  inputId="binary"
                  [(ngModel)]="nodeDetails.intermediate_node"
                /><br />
              </div>
              <div>
                <label for="Waiting_Stn" class="label">Waiting Node</label>
                <p-checkbox
                  id="Waiting_Stn"
                  [binary]="true"
                  inputId="binary"
                  [(ngModel)]="nodeDetails.waiting_node"
                />
            </div>

          <div class="Node-btn">
            <div *ngIf="validationError" class="validation-error">{{ validationError }}</div>
          </div>
          <div class="Node-btn">
            <button class="Delnode-btn" (click)="deleteSelectedNode()">Delete Node</button>
            <button class="savenode-btn" (click)="saveNodeDetails()">Save</button>
            <button class="closenode-btn" (click)="closeNodeDetailsPopup()">Close</button>
          </div>
        </div>
       </div>
        <div class="action-form">
          <div *ngIf="selectedAction === 'Move' && isMoveActionFormVisible" class="move-action-form">
            <p>Move Action Parameters</p>
            <div class="input-groupg">
              <label>Max Linear Velocity:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="moveParameters.maxLinearVelocity" /><br />

              <label>Max Angular Velocity:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="moveParameters.maxAngularVelocity" /><br />
            </div>
            <div class="input-groupg">
              <label>Max Tolerance at Goal X:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="moveParameters.maxToleranceAtGoalX" /><br />

              <label>Max Tolerance at Goal Y:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="moveParameters.maxToleranceAtGoalY" /><br />
            </div>
            <div class="input-groupg">
              <label>Max Tolerance at Goal Orientation:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="moveParameters.maxToleranceAtGoalOrientation" /><br />

              <label>End Point Orientation:</label>
              <input type="checkbox" [(ngModel)]="moveParameters.endPointOrientation" style="height: 20px;" /><br />
            </div>
            <div class="input-groupg">
              <label>Auto Robot Operation Mode:</label>
              <select [(ngModel)]="moveParameters.autoRobotMode" style="margin-right: 20rem;">
                <option value="mode1">Mode 1</option>
                <option value="mode2">Mode 2</option>
              </select><br/>
            </div>
              <button (click)="addAction()">Add</button>

          </div>


          <div *ngIf="selectedAction === 'Dock' && isDockActionFormVisible" class="move-action-form">
            <p>Dock Action Parameters</p>
            <div class="input-groupg">
              <label>Max Linear Velocity:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.maxLinearVelocity" /><br />

              <label>Max Tolerance at Goal X:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.maxToleranceAtGoalX" /><br />
            </div>
            <div class="input-groupg">
              <label>Max Tolerance at Goal Y:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.maxToleranceAtGoalY" /><br />

              <label>Max Tolerance at Goal Orientation:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.maxToleranceAtGoalOrientation" /><br />
            </div>
            <div class="input-groupg">
              <label>Goal Offset X:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.goalOffsetX" /><br />

              <label>Goal Offset Y:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.goalOffsetY" /><br />
            </div>
            <div class="input-groupg">
              <label>Goal Offset Orientation:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="dockParameters.goalOffsetOrientation" /><br />

              <label>End Point Orientation:</label>
              <input type="checkbox" [(ngModel)]="dockParameters.endPointOrientation" style="height: 20px;" /><br />
            </div>
            <div class="input-groupg">
              <label for="Waiting_Stn" class="label">Docking Type</label>
              <p-dropdown appendTo="body"
                [options]="dockingTypes"
                [(ngModel)]="dockParameters.dockingType"
                styleClass="small-dropdown"
                [autoDisplayFirst]="false"
                placeholder="Select Docking Type"
                [style]="{'height':'32px','width':'7rem','fontSize':'12px','display':'flex','align-items':'center','marginRight':'17rem'}"
              ></p-dropdown><br />
            </div>
              <button (click)="addAction()">Add</button>

          </div>

          <div *ngIf="selectedAction === 'Undock' && isUndockActionFormVisible" class="move-action-form">
            <p>Undock Action Parameters</p>
            <div class="input-groupg">
              <label>Max Linear Velocity:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="undockParameters.maxLinearVelocity" /><br />

              <label>Max Angular Velocity:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="undockParameters.maxAngularVelocity" /><br />
            </div>
            <div class="input-groupg">
              <label>Max Tolerance at Goal X:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="undockParameters.maxToleranceAtGoalX" /><br />

              <label>Max Tolerance at Goal Y:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="undockParameters.maxToleranceAtGoalY" /><br />
            </div>
            <div class="input-groupg">
              <label>Max Tolerance at Goal Orientation:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="undockParameters.maxToleranceAtGoalOrientation" /><br />

              <label>End Point Orientation:</label>
              <input type="checkbox" [(ngModel)]="undockParameters.endPointOrientation" style="height: 20px;" /><br />
            </div>
            <div class="input-groupg">
              <label>Undocking Distance:</label>
              <input pInputText type="number" min="0" max="1000" [(ngModel)]="undockParameters.undockingDistance" style="margin-right: 20rem;"/><br />
            </div>
              <button (click)="addAction()">Add</button>
          </div>

        </div>


      </div>
      </div>
    </div>
      <!-- Transparent canvas for plotting points -->
      <canvas class="maplayer" #imageCanvas></canvas>

      <div
        class="options-container"
        *ngIf="!isPlottingEnabled && !isOptionsMenuVisible && !isZonePlottingEnabled "
      >
        <button (click)="toggleOptionsMenu()" >
          <img src="../../assets/icons/options-icon.svg" alt="Options" />
        </button>
      </div>
      <div class="calibration-layer" *ngIf="isOptionsMenuVisible">
        <div class="dropdown">
          <button class="dropdown-button">Add Node</button>
          <div class="dropdown-content">
            <button (click)="setPlottingMode('single')">Single Node</button>
            <button (click)="setPlottingMode('multi')">Multi Node</button>
          </div>
        </div>
        <button class="mul-del" (click)="MuldelMode()">Delete Multiple Nodes</button>
        <div class="dropdown">
          <button class="dropdown-button">Connectivity</button>
          <div class="dropdown-content">
            <button (click)="setDirection('uni')">Uni-Directional</button>
            <button (click)="setDirection('bi')">Bi-Directional</button>
          </div>
        </div>
        <button (click)="startZonePlotting()">Zones</button>

        <div class="dropdown">
          <button class="dropdown-button">Add Assets</button>
          <div class="dropdown-content">
            <button (click)="selectAssetType('docking')">
              Docking Station
            </button>
            <button (click)="selectAssetType('charging')">
              Charging Station
            </button>
          </div>
        </div>

        <button (click)="openRobotPopup()">Add Robots</button>
        <!-- <button (click)="removeRobots()">Remove Robots</button> -->
        <button (click)="saveOpt()">Save</button>
        <button (click)="toggleOptionsMenu()">Back</button>
      </div>
    </div>

    <!-- <button class="close-button" (click)="close()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        width="24"
        height="24"
      >
        <path fill="none" d="M0 0h24v24H0z" />
        <path
          d="M12 10.586l4.95-4.95 1.414 1.414L13.414 12l4.95 4.95-1.414 1.414L12 13.414l-4.95 4.95-1.414-1.414L10.586 12 5.636 7.05l1.414-1.414L12 10.586z"
        />
      </svg>
    </button> -->
    <div  *ngIf="!showImage">
      <div *ngIf="validationError" class="validation-error">
        {{ validationError }}
      </div>
      <div class="button-container">
      <button *ngIf="fileName && !showImage" (click)="open()">Open</button>
      <button (click)="close()">Close</button>
    </div>
    </div>
  </div>
</div>

<app-robot-popup
  [isVisible]="isRobotPopupVisible"
  [mapName]="this.mapName"
  [robos]="this.robos"
  (close)="closeRobotPopup()"
  (addRobot)="placeRobots($event)"
></app-robot-popup>

<div *ngIf="isPopupVisible" class="popup-overlay1">
  <div class="popup-content1">
    <h4>Select Zone Type</h4>
    <select [(ngModel)]="zoneType">
      <option *ngFor="let zone of zoneTypeList" [value]="zone">
        {{ zone }}
      </option>
    </select>
    <div>
      <button (click)="zoneType !== null ? onZoneTypeSelected(zoneType) : null">Confirm</button>
      <button *ngIf="isDeleteVisible" (click)="onDeleteZone()">Delete</button>
      <button (click)="onCancel()">Cancel</button>
    </div>
  </div>
</div>


<div *ngIf="showPopup" class="popup-overlay1">
  <div class="popup-content1">
    <h3>Edge Details</h3>
    <div class="flex-items">
      <div class="first">
        <!-- <form (ngSubmit)="submitEdgeDetails()"> -->
        <div class="form-row">
          <label for="edgeId" style="padding-right: 3rem;">Edge ID:</label>
          <input pInputText
            id="edgeId"
            [(ngModel)]="currentEdge.edgeId"
            name="edgeId"
            required
          />
        </div>

        <div class="form-row">
          <label for="sequenceId" style="padding-right: .7rem;">Sequence ID:</label>
          <input pInputText
            id="sequenceId"
            type="number"
            min="0"
            max="1000"
            [(ngModel)]="currentEdge.sequenceId"
            name="sequenceId"
            required
          />
        </div>

        <div class="form-row">
          <label for="edgeDescription" style="padding-right: 1.2rem;">Description:</label>
          <input pInputText
            id="edgeDescription"
            [(ngModel)]="currentEdge.edgeDescription"
            name="edgeDescription"
          />
        </div>

        <div class="form-row">
          <label for="startNodeId" style="padding-right: .2rem;">Start Node ID:</label>
          <input pInputText
            id="startNodeId"
            [(ngModel)]="currentEdge.startNodeId"
            name="startNodeId"
            readonly
          />
        </div>

        <div class="form-row">
          <label for="released" style="padding-right: 5rem;">Released:</label>
          <input
            id="released"
            type="checkbox"
            [(ngModel)]="currentEdge.released"
            name="released"
          />
        </div>

        <div class="form-row">
          <label for="rotationAllowed" style="padding-right: 1.3rem;">Rotation Allowed:</label>
          <input
            id="rotationAllowed"
            type="checkbox"
            [(ngModel)]="currentEdge.rotationAllowed"
            name="rotationAllowed"
          />
        </div>
      </div>
      <div class="third">
        <div class="form-row">
          <label for="endNodeId" style="padding-right: 2.2rem;">End Node ID:</label>
          <input pInputText
            id="endNodeId"
            [(ngModel)]="currentEdge.endNodeId"
            name="endNodeId"
            readonly
          />
        </div>

        <div class="form-row">
          <label for="maxSpeed">Max Speed (m/s):</label>
          <input pInputText
            id="maxSpeed"
            type="number"
            min="0"
            max="1000"
            [(ngModel)]="currentEdge.maxSpeed"
            name="maxSpeed"
          />
        </div>

        <div class="form-row">
          <label for="maxHeight" style="padding-right: .8rem;">Max Height (m):</label>
          <input pInputText
            id="maxHeight"
            type="number"
            min="0"
            max="1000"
            [(ngModel)]="currentEdge.maxHeight"
            name="maxHeight"
          />
        </div>

          <div class="form-row1">
            <label for="minHeight" style="padding-right: 1.2rem;">Min Height (m):</label>
            <input pInputText
              id="minHeight"
              type="number"
              min="0"
              max="1000"
              [(ngModel)]="currentEdge.minHeight"
              name="minHeight"
            />
          </div>

          <div class="form-row1">
            <label for="orientation" style="padding-right: .5rem;">Orientation (rad):</label>
            <input pInputText
              id="orientation"
              type="number"
              min="0"
              max="1000"
              [(ngModel)]="currentEdge.orientation"
              name="orientation"
            />
          </div>
        </div>
        <div class="second">
          <div class="form-row1">
            <label for="orientationType" style="padding-right: 5rem;">Orientation Type:</label>
            <input pInputText
              id="orientationType"
              [(ngModel)]="currentEdge.orientationType"
              name="orientationType"
            />
          </div>

          <div class="form-row1">
            <label for="direction" style="padding-right: 8.5rem;">Direction:</label>
            <select pInputText
              id="direction"
              [(ngModel)]="currentEdge.direction"
              name="direction"
            >
              <option value="UN_DIRECTIONAL">Uni-directional</option>
              <option value="BI_DIRECTIONAL">Bi-directional</option>
            </select>
          </div>

          <div class="form-row1">
            <label for="maxRotationSpeed">Max Rotation Speed (rad/s):</label>
            <input pInputText
              id="maxRotationSpeed"
              type="number"
              min="0"
              max="100"
              [(ngModel)]="currentEdge.maxRotationSpeed"
              name="maxRotationSpeed"
            />
          </div>

          <div class="form-row1">
            <label for="length" style="padding-right: 9.8rem;">Length:</label>
            <input pInputText
              id="length"
              type="number"
              min="0"
              max="100"
              [(ngModel)]="currentEdge.length"
              name="length"
            />
          </div>

          <div class="form-row1">
            <label for="action" style="padding-right: 9.5rem;">Actions:</label>
            <input pInputText id="action" [(ngModel)]="currentEdge.action" name="action" />
          </div>
          <div *ngIf="showEdgeError" class="error-message">
            All required fields must be provided.
          </div>
        </div>
      </div>
    <div class="form-buttonss">
      <button type="submit" id="formBTN" (click)="updateEdge()">Save</button>
      <button type="button" id="formBTN" (click)="deleteEdge()">Delete</button>
      <button type="button" id="formBTN" (click)="hidePopup()">Cancel</button>
    </div>
    <!-- </form> -->
  </div>
</div>

<div *ngIf="DockPopup" class="popup-overlay1">
  <div class="popup-content1">
    <form>
      <!-- Validation Message -->
      <h4>Docking Station Details</h4>

      <div class="UDform">
        <label for="undockingDistance">Undocking Distance:</label>
        <input pInputText
          type="number"
          id="undockingDistance"
          name="undockingDistance"
          placeholder="Enter undockingDistance"
          [(ngModel)]="undockingDistance"
          min="1"
          max="1000"
          required
        />
      </div>

      <div class="UDform">
        <label for="description">Description:</label>
        <input pInputText
          type="text"
          id="description"
          name="description"
          placeholder="Enter Docking Description"
          [(ngModel)]="description"
          maxlength="255"
          (ngModelChange)="checkDescriptionLength()"
          required
        />

        <!-- Display warning if description exceeds 255 characters -->
        <div *ngIf="descriptionWarning" class="warning-message">
          Description cannot exceed 255 characters.
        </div>
      </div>
      <div
        *ngIf="validationMessage"
        class="validation-message"
        style="color: red; font: 10px sans-serif"
      >
        {{ validationMessage }}
      </div>
      <div class="Dock_btn">
        <button type="button" (click)="deleteSelectedAsset()">Delete</button>
        <button type="button" (click)="savePopupData()">Save</button>
        <button type="button" (click)="closePopup1()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<div class="popup-overlay1" *ngIf="showIntermediateNodesDialog">
  <div class="popup-content1">
    <div class="flex">
    <div>
    <p>Enter Number of Nodes</p>
    <input pInputText
      type="number"
      min="0"
      [(ngModel)]="numberOfIntermediateNodes"
      placeholder="Number of nodes"
      (ngModelChange)="onInputChanged()"
    />
  </div>
  <div class="node-separator"></div>
  <div>
    <p>Select Direction</p>
    <select [(ngModel)]="direction">
      <option value="uni">Uni-direction</option>
      <option value="bi">Bi-direction</option>
    </select>
  </div>
</div>
    <button *ngIf="isEnterButtonVisible" (click)="plotIntermediateNodes()">
      Enter
    </button>
  </div>
</div>

<div *ngIf="isConfirmationVisible" class="popup-overlay1">
  <div class="popup-content1">
    <p>Are you sure you want to Remove?</p>
    <div>
      <button type="button" (click)="confirmDelete()">Confirm</button>
      <button type="button" (click)="cancelDelete()">Cancel</button>
    </div>
  </div>
</div>
